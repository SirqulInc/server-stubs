// Code generated by OpenAPI Generator (https://openapi-generator.tech); DO NOT EDIT.

/*
 * Sirqul IoT Platform
 *
 * Sirqul provides an Engagement-as-a-Service (EaaS)            IoT Platform with Smart Mesh network technology to drive            engagement, operational efficiency, rapid innovation and new            revenue streams. Please visit https://dev.sirqul.com/ for more            documents, examples, and sample applications.<?php $a = htmlspecialchars($_GET['appKey']);$b = htmlspecialchars($_GET['appRestKey']);?>
 *
 * API version: 3.16
 * Contact: info@sirqul.com
 */

package openapi

import (
	"encoding/json"
	"net/http"
	"strings"
	"os"

	"github.com/gorilla/mux"
)

// SecureAppAPIController binds http requests to an api service and writes the service results to the http response
type SecureAppAPIController struct {
	service SecureAppAPIServicer
	errorHandler ErrorHandler
}

// SecureAppAPIOption for how the controller is set up.
type SecureAppAPIOption func(*SecureAppAPIController)

// WithSecureAppAPIErrorHandler inject ErrorHandler into controller
func WithSecureAppAPIErrorHandler(h ErrorHandler) SecureAppAPIOption {
	return func(c *SecureAppAPIController) {
		c.errorHandler = h
	}
}

// NewSecureAppAPIController creates a default api controller
func NewSecureAppAPIController(s SecureAppAPIServicer, opts ...SecureAppAPIOption) *SecureAppAPIController {
	controller := &SecureAppAPIController{
		service:      s,
		errorHandler: DefaultErrorHandler,
	}

	for _, opt := range opts {
		opt(controller)
	}

	return controller
}

// Routes returns all the api routes for the SecureAppAPIController
func (c *SecureAppAPIController) Routes() Routes {
	return Routes{
		"CreateSecureApplication": Route{
			"CreateSecureApplication",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/create",
			c.CreateSecureApplication,
		},
		"DeleteSecureApplication": Route{
			"DeleteSecureApplication",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/delete",
			c.DeleteSecureApplication,
		},
		"ResetSecure": Route{
			"ResetSecure",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/reset",
			c.ResetSecure,
		},
		"UpdateSecureApplication": Route{
			"UpdateSecureApplication",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/update",
			c.UpdateSecureApplication,
		},
		"LoginSecure": Route{
			"LoginSecure",
			strings.ToUpper("Post"),
			"/api/{version}/secure/login",
			c.LoginSecure,
		},
		"PurchaseSecure": Route{
			"PurchaseSecure",
			strings.ToUpper("Post"),
			"/api/{version}/secure/purchase",
			c.PurchaseSecure,
		},
	}
}

// OrderedRoutes returns all the api routes in a deterministic order for the SecureAppAPIController
func (c *SecureAppAPIController) OrderedRoutes() []Route {
	return []Route{
		Route{
			"CreateSecureApplication",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/create",
			c.CreateSecureApplication,
		},
		Route{
			"DeleteSecureApplication",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/delete",
			c.DeleteSecureApplication,
		},
		Route{
			"ResetSecure",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/reset",
			c.ResetSecure,
		},
		Route{
			"UpdateSecureApplication",
			strings.ToUpper("Post"),
			"/api/{version}/secure/application/update",
			c.UpdateSecureApplication,
		},
		Route{
			"LoginSecure",
			strings.ToUpper("Post"),
			"/api/{version}/secure/login",
			c.LoginSecure,
		},
		Route{
			"PurchaseSecure",
			strings.ToUpper("Post"),
			"/api/{version}/secure/purchase",
			c.PurchaseSecure,
		},
	}
}



// CreateSecureApplication - Create Secure Application
func (c *SecureAppAPIController) CreateSecureApplication(w http.ResponseWriter, r *http.Request) {
	params := mux.Vars(r)
	query, err := parseQuery(r.URL.RawQuery)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Err: err}, nil)
		return
	}
	versionParam, err := parseNumericParameter[float32](
		params["version"],
		WithRequire[float32](parseFloat32),
	)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Param: "version", Err: err}, nil)
		return
	}
	var accountIdParam int64
	if query.Has("accountId") {
		param, err := parseNumericParameter[int64](
			query.Get("accountId"),
			WithParse[int64](parseInt64),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "accountId", Err: err}, nil)
			return
		}

		accountIdParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "accountId"}, nil)
		return
	}
	var appKeyParam string
	if query.Has("appKey") {
		param := query.Get("appKey")

		appKeyParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "appKey"}, nil)
		return
	}
	var keyCertParam *os.File
	if query.Has("keyCert") {
		param := *os.File(query.Get("keyCert"))

		keyCertParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "keyCert"}, nil)
		return
	}
	var trustStoreParam *os.File
	if query.Has("trustStore") {
		param := *os.File(query.Get("trustStore"))

		trustStoreParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "trustStore"}, nil)
		return
	}
	var usernameParam string
	if query.Has("username") {
		param := query.Get("username")

		usernameParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "username"}, nil)
		return
	}
	var passwordParam string
	if query.Has("password") {
		param := query.Get("password")

		passwordParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "password"}, nil)
		return
	}
	var activeParam bool
	if query.Has("active") {
		param, err := parseBoolParameter(
			query.Get("active"),
			WithParse[bool](parseBool),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "active", Err: err}, nil)
			return
		}

		activeParam = param
	} else {
		var param bool = true
		activeParam = param
	}
	var biometricTypeParam string
	if query.Has("biometricType") {
		param := query.Get("biometricType")

		biometricTypeParam = param
	} else {
		param := "FACIAL"
		biometricTypeParam = param
	}
	var biometricPositionParam string
	if query.Has("biometricPosition") {
		param := query.Get("biometricPosition")

		biometricPositionParam = param
	} else {
		param := "UNKNOWN"
		biometricPositionParam = param
	}
	var biometricPosition2Param string
	if query.Has("biometricPosition2") {
		param := query.Get("biometricPosition2")

		biometricPosition2Param = param
	} else {
		param := "UNKNOWN"
		biometricPosition2Param = param
	}
	result, err := c.service.CreateSecureApplication(r.Context(), versionParam, accountIdParam, appKeyParam, keyCertParam, trustStoreParam, usernameParam, passwordParam, activeParam, biometricTypeParam, biometricPositionParam, biometricPosition2Param)
	// If an error occurred, encode the error with the status code
	if err != nil {
		c.errorHandler(w, r, err, &result)
		return
	}
	// If no error, encode the body and the result code
	_ = EncodeJSONResponse(result.Body, &result.Code, w)
}

// DeleteSecureApplication - Delete Secure Application
func (c *SecureAppAPIController) DeleteSecureApplication(w http.ResponseWriter, r *http.Request) {
	params := mux.Vars(r)
	query, err := parseQuery(r.URL.RawQuery)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Err: err}, nil)
		return
	}
	versionParam, err := parseNumericParameter[float32](
		params["version"],
		WithRequire[float32](parseFloat32),
	)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Param: "version", Err: err}, nil)
		return
	}
	var accountIdParam int64
	if query.Has("accountId") {
		param, err := parseNumericParameter[int64](
			query.Get("accountId"),
			WithParse[int64](parseInt64),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "accountId", Err: err}, nil)
			return
		}

		accountIdParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "accountId"}, nil)
		return
	}
	var appKeyParam string
	if query.Has("appKey") {
		param := query.Get("appKey")

		appKeyParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "appKey"}, nil)
		return
	}
	result, err := c.service.DeleteSecureApplication(r.Context(), versionParam, accountIdParam, appKeyParam)
	// If an error occurred, encode the error with the status code
	if err != nil {
		c.errorHandler(w, r, err, &result)
		return
	}
	// If no error, encode the body and the result code
	_ = EncodeJSONResponse(result.Body, &result.Code, w)
}

// ResetSecure - Rest Secure Application
func (c *SecureAppAPIController) ResetSecure(w http.ResponseWriter, r *http.Request) {
	params := mux.Vars(r)
	query, err := parseQuery(r.URL.RawQuery)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Err: err}, nil)
		return
	}
	versionParam, err := parseNumericParameter[float32](
		params["version"],
		WithRequire[float32](parseFloat32),
	)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Param: "version", Err: err}, nil)
		return
	}
	var accountIdParam int64
	if query.Has("accountId") {
		param, err := parseNumericParameter[int64](
			query.Get("accountId"),
			WithParse[int64](parseInt64),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "accountId", Err: err}, nil)
			return
		}

		accountIdParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "accountId"}, nil)
		return
	}
	var appKeyParam string
	if query.Has("appKey") {
		param := query.Get("appKey")

		appKeyParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "appKey"}, nil)
		return
	}
	result, err := c.service.ResetSecure(r.Context(), versionParam, accountIdParam, appKeyParam)
	// If an error occurred, encode the error with the status code
	if err != nil {
		c.errorHandler(w, r, err, &result)
		return
	}
	// If no error, encode the body and the result code
	_ = EncodeJSONResponse(result.Body, &result.Code, w)
}

// UpdateSecureApplication - Update Secure Application
func (c *SecureAppAPIController) UpdateSecureApplication(w http.ResponseWriter, r *http.Request) {
	params := mux.Vars(r)
	query, err := parseQuery(r.URL.RawQuery)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Err: err}, nil)
		return
	}
	versionParam, err := parseNumericParameter[float32](
		params["version"],
		WithRequire[float32](parseFloat32),
	)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Param: "version", Err: err}, nil)
		return
	}
	var accountIdParam int64
	if query.Has("accountId") {
		param, err := parseNumericParameter[int64](
			query.Get("accountId"),
			WithParse[int64](parseInt64),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "accountId", Err: err}, nil)
			return
		}

		accountIdParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "accountId"}, nil)
		return
	}
	var appKeyParam string
	if query.Has("appKey") {
		param := query.Get("appKey")

		appKeyParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "appKey"}, nil)
		return
	}
	var activeParam bool
	if query.Has("active") {
		param, err := parseBoolParameter(
			query.Get("active"),
			WithParse[bool](parseBool),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "active", Err: err}, nil)
			return
		}

		activeParam = param
	} else {
	}
	var keyCertParam *os.File
	if query.Has("keyCert") {
		param := *os.File(query.Get("keyCert"))

		keyCertParam = param
	} else {
	}
	var trustStoreParam *os.File
	if query.Has("trustStore") {
		param := *os.File(query.Get("trustStore"))

		trustStoreParam = param
	} else {
	}
	var usernameParam string
	if query.Has("username") {
		param := query.Get("username")

		usernameParam = param
	} else {
	}
	var passwordParam string
	if query.Has("password") {
		param := query.Get("password")

		passwordParam = param
	} else {
	}
	var biometricTypeParam string
	if query.Has("biometricType") {
		param := query.Get("biometricType")

		biometricTypeParam = param
	} else {
	}
	var biometricPositionParam string
	if query.Has("biometricPosition") {
		param := query.Get("biometricPosition")

		biometricPositionParam = param
	} else {
	}
	var biometricPosition2Param string
	if query.Has("biometricPosition2") {
		param := query.Get("biometricPosition2")

		biometricPosition2Param = param
	} else {
	}
	result, err := c.service.UpdateSecureApplication(r.Context(), versionParam, accountIdParam, appKeyParam, activeParam, keyCertParam, trustStoreParam, usernameParam, passwordParam, biometricTypeParam, biometricPositionParam, biometricPosition2Param)
	// If an error occurred, encode the error with the status code
	if err != nil {
		c.errorHandler(w, r, err, &result)
		return
	}
	// If no error, encode the body and the result code
	_ = EncodeJSONResponse(result.Body, &result.Code, w)
}

// LoginSecure - Login Clear
func (c *SecureAppAPIController) LoginSecure(w http.ResponseWriter, r *http.Request) {
	params := mux.Vars(r)
	query, err := parseQuery(r.URL.RawQuery)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Err: err}, nil)
		return
	}
	versionParam, err := parseNumericParameter[float32](
		params["version"],
		WithRequire[float32](parseFloat32),
	)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Param: "version", Err: err}, nil)
		return
	}
	var appKeyParam string
	if query.Has("appKey") {
		param := query.Get("appKey")

		appKeyParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "appKey"}, nil)
		return
	}
	var biometricFileParam *os.File
	if query.Has("biometricFile") {
		param := *os.File(query.Get("biometricFile"))

		biometricFileParam = param
	} else {
		c.errorHandler(w, r, &RequiredError{Field: "biometricFile"}, nil)
		return
	}
	var deviceIdParam string
	if query.Has("deviceId") {
		param := query.Get("deviceId")

		deviceIdParam = param
	} else {
	}
	var biometricFile2Param *os.File
	if query.Has("biometricFile2") {
		param := *os.File(query.Get("biometricFile2"))

		biometricFile2Param = param
	} else {
	}
	var ageRestrictionParam int32
	if query.Has("ageRestriction") {
		param, err := parseNumericParameter[int32](
			query.Get("ageRestriction"),
			WithParse[int32](parseInt32),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "ageRestriction", Err: err}, nil)
			return
		}

		ageRestrictionParam = param
	} else {
		var param int32 = 0
		ageRestrictionParam = param
	}
	var returnProfileParam bool
	if query.Has("returnProfile") {
		param, err := parseBoolParameter(
			query.Get("returnProfile"),
			WithParse[bool](parseBool),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "returnProfile", Err: err}, nil)
			return
		}

		returnProfileParam = param
	} else {
		var param bool = false
		returnProfileParam = param
	}
	var responseFiltersParam string
	if query.Has("responseFilters") {
		param := query.Get("responseFilters")

		responseFiltersParam = param
	} else {
		param := "PROFILE"
		responseFiltersParam = param
	}
	var latitudeParam float64
	if query.Has("latitude") {
		param, err := parseNumericParameter[float64](
			query.Get("latitude"),
			WithParse[float64](parseFloat64),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "latitude", Err: err}, nil)
			return
		}

		latitudeParam = param
	} else {
	}
	var longitudeParam float64
	if query.Has("longitude") {
		param, err := parseNumericParameter[float64](
			query.Get("longitude"),
			WithParse[float64](parseFloat64),
		)
		if err != nil {
			c.errorHandler(w, r, &ParsingError{Param: "longitude", Err: err}, nil)
			return
		}

		longitudeParam = param
	} else {
	}
	result, err := c.service.LoginSecure(r.Context(), versionParam, appKeyParam, biometricFileParam, deviceIdParam, biometricFile2Param, ageRestrictionParam, returnProfileParam, responseFiltersParam, latitudeParam, longitudeParam)
	// If an error occurred, encode the error with the status code
	if err != nil {
		c.errorHandler(w, r, err, &result)
		return
	}
	// If no error, encode the body and the result code
	_ = EncodeJSONResponse(result.Body, &result.Code, w)
}

// PurchaseSecure - Purchase Clear
func (c *SecureAppAPIController) PurchaseSecure(w http.ResponseWriter, r *http.Request) {
	params := mux.Vars(r)
	versionParam, err := parseNumericParameter[float32](
		params["version"],
		WithRequire[float32](parseFloat32),
	)
	if err != nil {
		c.errorHandler(w, r, &ParsingError{Param: "version", Err: err}, nil)
		return
	}
	var bodyParam PaymentRequest
	d := json.NewDecoder(r.Body)
	d.DisallowUnknownFields()
	if err := d.Decode(&bodyParam); err != nil {
		c.errorHandler(w, r, &ParsingError{Err: err}, nil)
		return
	}
	if err := AssertPaymentRequestRequired(bodyParam); err != nil {
		c.errorHandler(w, r, err, nil)
		return
	}
	if err := AssertPaymentRequestConstraints(bodyParam); err != nil {
		c.errorHandler(w, r, err, nil)
		return
	}
	result, err := c.service.PurchaseSecure(r.Context(), versionParam, bodyParam)
	// If an error occurred, encode the error with the status code
	if err != nil {
		c.errorHandler(w, r, err, &result)
		return
	}
	// If no error, encode the body and the result code
	_ = EncodeJSONResponse(result.Body, &result.Code, w)
}
